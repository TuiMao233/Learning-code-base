<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微信公众号服务开发 | Mr.Mao&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="/mao-blog/favicon.ico">
    <meta name="description" content="For man is man and master of his fate.">
    
    <link rel="preload" href="/mao-blog/assets/css/0.styles.c7f09f7b.css" as="style"><link rel="preload" href="/mao-blog/assets/js/app.19e1b50c.js" as="script"><link rel="preload" href="/mao-blog/assets/js/4.512e8a4d.js" as="script"><link rel="preload" href="/mao-blog/assets/js/1.6b005ada.js" as="script"><link rel="preload" href="/mao-blog/assets/js/9.cea725c3.js" as="script"><link rel="prefetch" href="/mao-blog/assets/js/10.8008c15a.js"><link rel="prefetch" href="/mao-blog/assets/js/11.e6d5e627.js"><link rel="prefetch" href="/mao-blog/assets/js/12.5df4cc14.js"><link rel="prefetch" href="/mao-blog/assets/js/13.64a3b0dc.js"><link rel="prefetch" href="/mao-blog/assets/js/14.92c69349.js"><link rel="prefetch" href="/mao-blog/assets/js/15.fcb00b5c.js"><link rel="prefetch" href="/mao-blog/assets/js/16.177fc3f8.js"><link rel="prefetch" href="/mao-blog/assets/js/17.35b5192e.js"><link rel="prefetch" href="/mao-blog/assets/js/18.4059f020.js"><link rel="prefetch" href="/mao-blog/assets/js/19.d0f23759.js"><link rel="prefetch" href="/mao-blog/assets/js/20.2d4db1fa.js"><link rel="prefetch" href="/mao-blog/assets/js/21.514837fa.js"><link rel="prefetch" href="/mao-blog/assets/js/22.27a37e8b.js"><link rel="prefetch" href="/mao-blog/assets/js/23.897a67bc.js"><link rel="prefetch" href="/mao-blog/assets/js/24.c649adb1.js"><link rel="prefetch" href="/mao-blog/assets/js/25.bccb3f04.js"><link rel="prefetch" href="/mao-blog/assets/js/26.705ac85b.js"><link rel="prefetch" href="/mao-blog/assets/js/27.e4123e2d.js"><link rel="prefetch" href="/mao-blog/assets/js/28.46bcae57.js"><link rel="prefetch" href="/mao-blog/assets/js/29.c4272f05.js"><link rel="prefetch" href="/mao-blog/assets/js/3.2246673a.js"><link rel="prefetch" href="/mao-blog/assets/js/30.28bc60fe.js"><link rel="prefetch" href="/mao-blog/assets/js/31.c3758186.js"><link rel="prefetch" href="/mao-blog/assets/js/32.db3244fa.js"><link rel="prefetch" href="/mao-blog/assets/js/33.06b2e404.js"><link rel="prefetch" href="/mao-blog/assets/js/34.87d9e7a4.js"><link rel="prefetch" href="/mao-blog/assets/js/35.c126287d.js"><link rel="prefetch" href="/mao-blog/assets/js/36.8f3be9db.js"><link rel="prefetch" href="/mao-blog/assets/js/37.b916e469.js"><link rel="prefetch" href="/mao-blog/assets/js/38.d90b2cf2.js"><link rel="prefetch" href="/mao-blog/assets/js/39.6e0ceebe.js"><link rel="prefetch" href="/mao-blog/assets/js/40.1b64d216.js"><link rel="prefetch" href="/mao-blog/assets/js/41.ebf384c2.js"><link rel="prefetch" href="/mao-blog/assets/js/42.9881274f.js"><link rel="prefetch" href="/mao-blog/assets/js/43.53f0eb78.js"><link rel="prefetch" href="/mao-blog/assets/js/44.56761054.js"><link rel="prefetch" href="/mao-blog/assets/js/45.b0ff1d14.js"><link rel="prefetch" href="/mao-blog/assets/js/46.aaaf7c00.js"><link rel="prefetch" href="/mao-blog/assets/js/47.18cca51b.js"><link rel="prefetch" href="/mao-blog/assets/js/48.39030ea6.js"><link rel="prefetch" href="/mao-blog/assets/js/49.9ab0ecf9.js"><link rel="prefetch" href="/mao-blog/assets/js/5.8cda11d4.js"><link rel="prefetch" href="/mao-blog/assets/js/50.0bffed31.js"><link rel="prefetch" href="/mao-blog/assets/js/51.ff3d6c79.js"><link rel="prefetch" href="/mao-blog/assets/js/52.87903e4e.js"><link rel="prefetch" href="/mao-blog/assets/js/53.5759e67a.js"><link rel="prefetch" href="/mao-blog/assets/js/54.be8026fc.js"><link rel="prefetch" href="/mao-blog/assets/js/55.866a8231.js"><link rel="prefetch" href="/mao-blog/assets/js/56.e12d34a8.js"><link rel="prefetch" href="/mao-blog/assets/js/57.57fd273b.js"><link rel="prefetch" href="/mao-blog/assets/js/58.90ce6d0a.js"><link rel="prefetch" href="/mao-blog/assets/js/59.3863dc39.js"><link rel="prefetch" href="/mao-blog/assets/js/6.6d443000.js"><link rel="prefetch" href="/mao-blog/assets/js/60.9e201b5f.js"><link rel="prefetch" href="/mao-blog/assets/js/61.d56ed0f8.js"><link rel="prefetch" href="/mao-blog/assets/js/62.b21d1cc3.js"><link rel="prefetch" href="/mao-blog/assets/js/63.eadaa890.js"><link rel="prefetch" href="/mao-blog/assets/js/64.67bc0773.js"><link rel="prefetch" href="/mao-blog/assets/js/65.ea6aa7cc.js"><link rel="prefetch" href="/mao-blog/assets/js/66.cc349a1f.js"><link rel="prefetch" href="/mao-blog/assets/js/67.838b75e8.js"><link rel="prefetch" href="/mao-blog/assets/js/68.e59ea1bc.js"><link rel="prefetch" href="/mao-blog/assets/js/69.6ac56165.js"><link rel="prefetch" href="/mao-blog/assets/js/7.4209526f.js"><link rel="prefetch" href="/mao-blog/assets/js/70.0dc5fc42.js"><link rel="prefetch" href="/mao-blog/assets/js/71.a9ff44b1.js"><link rel="prefetch" href="/mao-blog/assets/js/72.bd59cddf.js"><link rel="prefetch" href="/mao-blog/assets/js/73.b6b0d409.js"><link rel="prefetch" href="/mao-blog/assets/js/74.92094ea4.js"><link rel="prefetch" href="/mao-blog/assets/js/75.57b289ff.js"><link rel="prefetch" href="/mao-blog/assets/js/76.fae4f14d.js"><link rel="prefetch" href="/mao-blog/assets/js/77.c4f1a7a5.js"><link rel="prefetch" href="/mao-blog/assets/js/78.72a68f19.js"><link rel="prefetch" href="/mao-blog/assets/js/79.42919070.js"><link rel="prefetch" href="/mao-blog/assets/js/8.23939aab.js"><link rel="prefetch" href="/mao-blog/assets/js/80.063e6e91.js"><link rel="prefetch" href="/mao-blog/assets/js/81.c0a3b3d7.js">
    <link rel="stylesheet" href="/mao-blog/assets/css/0.styles.c7f09f7b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Mr.Mao's blog</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>For man is man and master of his fate.</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Mr.Mao</span>
            
          <span data-v-4e82dffc>2020 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mao-blog/" class="home-link router-link-active"><img src="/mao-blog/avatar.png" alt="Mr.Mao's blog" class="logo"> <span class="site-name">Mr.Mao's blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mao-blog/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      软件开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mao-blog/软件开发/前端笔记/01-HTML-超文本标记语言.html" class="nav-link"><i class="undefined"></i>
  前端开发
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/软件开发/后端笔记/01-php-后端应用.html" class="nav-link"><i class="undefined"></i>
  后端开发
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/软件开发/扩展笔记/01-Promise-异步解决方案.html" class="nav-link"><i class="undefined"></i>
  知识扩展
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-npm"></i>
      我的扩展
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mao-blog/我的扩展/create-uniapp-view.html" class="nav-link"><i class="undefined"></i>
  快速创建视图 | create-uniapp-view
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/我的扩展/u-draw-poster/01-base-desc.html" class="nav-link"><i class="undefined"></i>
  多端海报绘制 | uni-draw-poster
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/我的扩展/form-strategy.html" class="nav-link"><i class="undefined"></i>
  表单策略验证 | form-strategy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-date"></i>
      规划指南
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mao-blog/规划指南/01-日常指标.html" class="nav-link"><i class="undefined"></i>
  生活指标
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/规划指南/02-总结与规划.html" class="nav-link"><i class="undefined"></i>
  总结与规划
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/个人记录/职场事项.html" class="nav-link"><i class="undefined"></i>
  职场 RULE
</a></li></ul></div></div><div class="nav-item"><a href="/mao-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/mao-blog/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    Mr.Mao
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>70</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>46</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/mao-blog/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      软件开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mao-blog/软件开发/前端笔记/01-HTML-超文本标记语言.html" class="nav-link"><i class="undefined"></i>
  前端开发
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/软件开发/后端笔记/01-php-后端应用.html" class="nav-link"><i class="undefined"></i>
  后端开发
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/软件开发/扩展笔记/01-Promise-异步解决方案.html" class="nav-link"><i class="undefined"></i>
  知识扩展
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-npm"></i>
      我的扩展
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mao-blog/我的扩展/create-uniapp-view.html" class="nav-link"><i class="undefined"></i>
  快速创建视图 | create-uniapp-view
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/我的扩展/u-draw-poster/01-base-desc.html" class="nav-link"><i class="undefined"></i>
  多端海报绘制 | uni-draw-poster
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/我的扩展/form-strategy.html" class="nav-link"><i class="undefined"></i>
  表单策略验证 | form-strategy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-date"></i>
      规划指南
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mao-blog/规划指南/01-日常指标.html" class="nav-link"><i class="undefined"></i>
  生活指标
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/规划指南/02-总结与规划.html" class="nav-link"><i class="undefined"></i>
  总结与规划
</a></li><li class="dropdown-item"><!----> <a href="/mao-blog/个人记录/职场事项.html" class="nav-link"><i class="undefined"></i>
  职场 RULE
</a></li></ul></div></div><div class="nav-item"><a href="/mao-blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/01-html-chao-wen-ben-biao-ji-yu-yan.html" class="sidebar-link">HTML 超文本标记语言</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/02-css2-ying-yong.html" class="sidebar-link">CSS2 应用</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/03-css3-ying-yong.html" class="sidebar-link">CSS3 应用</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/04-less-cssyu-chu-li-yu-yan.html" class="sidebar-link">Less CSS预处理语言</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/05-javascript-ying-yong.html" class="sidebar-link">JavaScript 应用</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/06-javascript-shen-ru.html" class="sidebar-link">JavaScript 深入</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/07-javascript-xing-neng-you-hua.html" class="sidebar-link">JavaScript 性能优化</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/08-lodash-gong-ju-mo-kuai-ying-yong.html" class="sidebar-link">Lodash 简介</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/09-html5-javascript-ying-yong.html" class="sidebar-link">HTML5 JavaScript 应用</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/10-ajax-yi-bu-shu-ju-chuan-shu.html" class="sidebar-link">Ajax 异步数据传输</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/11-npm--bao-guan-li-gong-ju.html" class="sidebar-link">NPM  包管理工具</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/12-zepto-qian-duan-kuang-jia-kai-fa.html" class="sidebar-link">Zepto 前端框架开发</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/13-angularjs-qian-duan-kuang-jia-kai-fa-jiu-ban-.html" class="sidebar-link">AngularJS 前端框架开发(旧版)</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/14-ecmascript-6-8-biao-zhun.html" class="sidebar-link">ECMAScript 6</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/15-javascript-mo-kuai-hua-ying-yong.html" class="sidebar-link">JavaScript 模块化应用</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/16-eslint-dai-ma-jian-ce-gong-ju.html" class="sidebar-link">Eslint 代码检测工具</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/17-git-ban-ben-kong-zhi-xi-tong.html" class="sidebar-link">Git 版本控制系统</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/18-grunt-kai-fa-yu-sheng-chan-huan-jing.html" class="sidebar-link">Grunt 开发与生产环境</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/19-gulp-kai-fa-yu-sheng-chan-huan-jing.html" class="sidebar-link">Gulp 开发与生产环境</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/20-webpack-kai-fa-huan-jing.html" class="sidebar-link">webpack 开发环境</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/21-webpack-sheng-chan-huan-jing.html" class="sidebar-link">webpack 生产环境</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/22-webpack-you-hua-huan-jing.html" class="sidebar-link">webpack 优化环境</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/23-webpack-quan-mian-fen-xi.html" class="sidebar-link">react-cli 全面分析</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/24-webpack-xiang-xi-pei-zhi.html" class="sidebar-link">webpack 详细配置</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/25-react-qian-duan-kuang-jia-kai-fa.html" class="sidebar-link">React 前端框架开发</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/26-reacthooks-v16.8xin-te-xing.html" class="sidebar-link">ReactHooks v16.8新特性</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/27-vue2-jian-jin-shi-qian-duan-kuang-jia-kai-fa.html" class="sidebar-link">Vue2 渐进式前端框架开发</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/28-vue3-jian-jin-shi-qian-duan-kuang-jia-kai-fa.html" class="sidebar-link">Vue3 渐进式前端框架开发</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/29-axios-jie-kou-qing-qiu-ku.html" class="sidebar-link">axios 接口请求库</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/30-mobile.app-yuan-sheng-webappkai-fa.html" class="sidebar-link">H5原生WebAPP开发</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/31-wei-xin-yuan-sheng-xiao-cheng-xu-kai-fa.html" class="sidebar-link">微信原生小程序开发</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/32-mpvue-xiao-cheng-xu-kai-fa.html" class="sidebar-link">mpvue 小程序开发</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/33-uniapp-duo-duan-ying-yong-kai-fa.html" class="sidebar-link">uniapp 多端应用开发</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html" aria-current="page" class="active sidebar-link">微信公众号服务开发</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/35-uniapp-duo-duan-ying-yong-kai-fa.html" class="sidebar-link">uniapp 多端应用开发</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/36-javascript-she-ji-mo-shi.html" class="sidebar-link">JavaScript 设计模式</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/37-typescript-ying-yong.html" class="sidebar-link">TypeScript 应用</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/38-esmascript-8-11-biao-zhun.html" class="sidebar-link">ESMAScript 8</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/39-jest-zi-dong-hua-bu-shu-ce-shi.html" class="sidebar-link">Jest 自动化部署测试</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/40-vite-shi-yong-yu-yuan-li-fen-xi.html" class="sidebar-link">Vite 使用与原理分析</a></li><li><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/41-ji-shu-zhan-gou-jian-fang-an.html" class="sidebar-link">技术栈构建方案</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>微信公众号服务开发</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Mr.Mao</span>
            
          <span data-v-4e82dffc>2020 - </span>
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">微信公众号服务开发</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>Mr.Mao</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>11/1/2020</span></i> <i class="iconfont reco-eye" data-v-1ff7123e><span id="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-1ff7123e><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>微信公众号服务开发</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="微信公众号简述"><a href="#微信公众号简述" class="header-anchor">#</a> 微信公众号简述</h2> <p>微信公众平台,是给个人、企业和组织提供业务服务与用户管理能力的全新服务平台。简单来说，一个提供服务平台。</p> <p>**注册微信公众号：**https://mp.weixin.qq.com/</p> <h3 id="微信公众号的分类"><a href="#微信公众号的分类" class="header-anchor">#</a> 微信公众号的分类</h3> <h4 id="订阅号"><a href="#订阅号" class="header-anchor">#</a> 订阅号</h4> <p>**适用主要人群：**个人、媒体。
**群发次数：**订阅号（认证用户、非认证用户）1天内可群发1条消息。
为媒体和个人提供一种新的信息传播方式，主要功能是在微信侧给用户传达资讯；（功能类似报纸杂志）</p> <h4 id="服务号"><a href="#服务号" class="header-anchor">#</a> 服务号</h4> <p>**适用主要人群：**企业、政府或其他组织。
**群发次数：**服务号1个月（按自然月）内可发送4条群发消息。
为企业和组织提供更强大的业务服务与用户管理能力，主要偏向服务类交互（功能类似银行，12315，114等）</p> <h4 id="企业微信-原企业号"><a href="#企业微信-原企业号" class="header-anchor">#</a> 企业微信（原企业号）</h4> <p>企业微信继承企业号所有能力，同时为企业提供专业的通讯工具、丰富的办公应用与API，助力企业高效沟通与办公。</p> <h3 id="订阅与服务号的主要区别"><a href="#订阅与服务号的主要区别" class="header-anchor">#</a> 订阅与服务号的主要区别</h3> <h4 id="推送频率"><a href="#推送频率" class="header-anchor">#</a> 推送频率</h4> <p>订阅号：1天内可群发1条消息。			服务号：1个月内可发送4条群发消息。</p> <h4 id="提供功能"><a href="#提供功能" class="header-anchor">#</a> 提供功能</h4> <p>订阅号：包含大部分功能。				服务号：认证的服务号包含全部功能。</p> <h4 id="适用人群"><a href="#适用人群" class="header-anchor">#</a> 适用人群</h4> <p>订阅号：个人、媒体。				服务号：企业、政府或其他组织。</p> <h3 id="使用微信号"><a href="#使用微信号" class="header-anchor">#</a> 使用微信号</h3> <p>登录后，页面左边将会有一排功能选项，订阅号中一共有5个功能可以直接设置使用。</p> <img src="img/officialaccount/wxgoneng.png" style="float:left;"> <h2 id="映射服务器架构"><a href="#映射服务器架构" class="header-anchor">#</a> 映射服务器架构</h2> <h3 id="构建node-js服务器"><a href="#构建node-js服务器" class="header-anchor">#</a> 构建node.js服务器</h3> <p><code>demo.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入express模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建app应用对象</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 添加中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 监听端口号</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器启动成功'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>命令运行服务器：</strong><code>node demo.js</code></p> <h3 id="ngrok-映射内网端口"><a href="#ngrok-映射内网端口" class="header-anchor">#</a> ngrok 映射内网端口</h3> <div class="language- extra-class"><pre class="language-text"><code>|- 授权命令 -|
ngrok authtoken 1aHiCly2wNBjST2mtF4oJp92Zjj_3sM27HoSy4yDSUtc6tRdL
|- 运行开发端口 -|
ngrok http 3000
</code></pre></div><img src="img/officialaccount/ngrok.png" alt="图片4" style="zoom:80%;"> <h2 id="微信公众号开发设置"><a href="#微信公众号开发设置" class="header-anchor">#</a> 微信公众号开发设置</h2> <h3 id="微信公众号的请求流程"><a href="#微信公众号的请求流程" class="header-anchor">#</a> 微信公众号的请求流程</h3> <p><img src="data:image/jpeg;base64,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Ysqm7KNUD++riEGtb7fcckv3xz/+sfvgBz+42t7qcSwt10uO2nGo9mJS6ttQfqihahTv27ok+d///tfddNNN3SWXXNK9+c1vXm2ThhqqPEvo4X0VMRjrG+rx0Ucf7X73u99173nPe1bbpKGGahq141DtxaTUt6H82IE3p8TevXuVRAFJkwgepp4eOnSo+8Mf/tB97nOf6173utet1lsXV1xxBW0/JTCu3PJWo1QP1WNMhurxiSee6O6///7u6quv7t761reu1lsX3/nOd2j7lmLJ+UO1F5Oh2isNXaFqFO8bznqvu+66vok69dRTV++NCV2hylOyD1x5+O9//9u9+OKL3fPPP98999xz3bPPPtvddddd3dNPP9099dRT/f7w5fr44493jz32WO/ZI4880j300EPdgw8+2B08eLC78cYbV76oHuPg6xH5AM937drVvelNb1q9NyZ0hWoatePwHooYlPo2lB9qqBol9e2Tn/xkd9JJJ61elwbOms8777zuIx/5SP84JXAvSG55Sawbx7nnntt99KMf7d//0Ic+1B/rnHPO6d7//vd3Z599dve+972v/xnl3e9+d3+PGOId73hH9/a3v71729ve1r3lLW/pf/bEF9wZZ5zRvfGNb+ze8IY39FfxTj/99O60007rm9FTTjmlO/nkk3tNX/3qV3evetWruhNPPLF75Stf2Z1wwgndK17xiu7444/vXv7yl3fHHXdcVtM5QvUYh7Qev//973evf/3rycuS+PjHP9599atfHR1f+tKXsstLomQfuAfzG9/4RnfppZd23/zmN7tvf/vb3Xe/+93++ZVXXtn96Ec/6m+s/8lPftJdddVV3c9//vPul7/8Zd9c/uY3v+l/7sQV9D/96U/dX/7yl+7vf/97d8MNN/QnE3h/z549/b2euNqAP5zZv39/d++99/ZX+Q4cONCffOBEBFficYKCxvWZZ55ZBU5QDh8+vDZwopMLHMc8UO3FIa29Mb6poRJbSH372Mc+1n/Z22vFsRGqxzik9aiIH6q9OKS1N8Y3NVRiC943nLXhTPFTn/pUf1XF3hsTn/nMZ7qf/vSn/U8NeJwSuP8jt7wk1o0DZ7s/+9nP+jNeBO5J+cUvftFdc801/Rnwr371qz5wJoz1fv3rX/dnvL/97W/7s2L8STrOjPFXVYhrr722P0vGT6V//vOf+7Pl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" alt="1586397335(1)"></p> <h3 id="填写接口信息配置"><a href="#填写接口信息配置" class="header-anchor">#</a> 填写接口信息配置</h3> <p>开发/开发者工具  ==&gt;  开发者文档  ==&gt;  开始开发/接口测试号申请  ==&gt;  进入微信公众帐号测试号申请系统</p> <img src="img/officialaccount/fwq.png" alt="图片2" style="zoom:67%;"> <h3 id="服务器接口信息配置"><a href="#服务器接口信息配置" class="header-anchor">#</a> 服务器接口信息配置</h3> <p>填写ngrok内网渗透的URL和Token提交后，微信会发送一个请求到填写的url上，服务器需要对请求处理并返回给微信才能配置成功</p> <img src="img/officialaccount/jkxxpz.png" alt="图片3" style="zoom:67%;"> <p><strong>微信接口配置请求参数</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  signature<span class="token operator">:</span> 'c35b593471d122b1683c1090eb4dffa3a494e14c'<span class="token punctuation">,</span> <span class="token comment">// 微信加密签名</span>
  echostr<span class="token operator">:</span> '<span class="token number">8914314992233147389</span>'<span class="token punctuation">,</span>		<span class="token comment">// 随机字符串</span>
  timestamp<span class="token operator">:</span> '<span class="token number">1586400252</span>'<span class="token punctuation">,</span>		<span class="token comment">// 微信发送请求时间戳</span>
  nonce<span class="token operator">:</span> '<span class="token number">267878625</span>'		<span class="token comment">// 随机数字</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="验证服务器请求来源"><a href="#验证服务器请求来源" class="header-anchor">#</a> 验证服务器请求来源</h3> <div class="language- extra-class"><pre class="language-text"><code>1）将timestamp、nonce、token三个参数进行字典序排序 (a b c.... 1 2 3...)
2）将三个参数字符串拼接成一个字符串进行sha1加密 
3）开发者获得加密后的字符串 与 signature(微信加密签名)对比， 标识该请求来源于微信
	 如果比较一样、说明信息来源于微信服务器，返回echostr给微信服务器
	 如果不一样，说明不是微信服务器发送的消息，返回error
</code></pre></div><p><strong>安装sha1加密：</strong><code>cnpm i sha1 --save</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入express模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 引入sha1加密模块</span>
<span class="token keyword">const</span> sha1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sha1'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建app应用对象</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">/* 验证服务器有效性(接收处理所有参数) */</span>
<span class="token comment">// 配置官网提供的参数</span>
<span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token string">'mrMaoHTML15106'</span>
<span class="token keyword">const</span> appID <span class="token operator">=</span> <span class="token string">'wxa2a6b98bb1a339d6'</span>
<span class="token keyword">const</span> appsecret <span class="token operator">=</span> <span class="token string">'d0896af5e43a366558cb05e68f6ce7c8'</span>
<span class="token comment">// 添加默认根路径中间件请求路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 获取请求参数：加密签名、随机字符串、请求时间戳、随机数字</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>signature<span class="token punctuation">,</span> echostr<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query
    <span class="token comment">// 进行字典排序, 并进行拼串</span>
    <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> token<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token comment">// 进行sha1加密</span>
    <span class="token keyword">const</span> sha1Str <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
    <span class="token comment">// 加密字符串进行微信服务器比较。比较成功返回随机字符串，比较失败返回error。</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>sha1Str <span class="token operator">===</span> signature<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>echostr<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 监听端口号</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器启动成功'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="进行模块化管理"><a href="#进行模块化管理" class="header-anchor">#</a> 进行模块化管理</h3> <div class="language- extra-class"><pre class="language-text"><code>├─ config/           	## 存储配置信息目录
│   ├─ index.js
├── wechat/           ## 核心功能库(路由中间件函数)
│   ├─ auth.js		    	## 验证服务器功能
├── app.js         	  ## 路由接口启动文件
├── package.json     	## 配置文件
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* config/index.js:配置信息对象模块 */</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    token<span class="token operator">:</span> <span class="token string">'mrMaoHTML15106'</span><span class="token punctuation">,</span>
    appID<span class="token operator">:</span> <span class="token string">'wxa2a6b98bb1a339d6'</span><span class="token punctuation">,</span>
    appsecret<span class="token operator">:</span> <span class="token string">'d0896af5e43a366558cb05e68f6ce7c8'</span>
<span class="token punctuation">}</span>

<span class="token comment">/* wechat/auth.js:微信身份验证模块 */</span>
<span class="token comment">// 引入sha1加密模块</span>
<span class="token keyword">const</span> sha1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sha1'</span><span class="token punctuation">)</span>
<span class="token comment">// 引入token数据模块</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>token<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 获取请求参数：加密签名、随机字符串、请求时间戳、随机数字</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>signature<span class="token punctuation">,</span> echostr<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query
    <span class="token comment">// 进行字典排序, 并进行拼串</span>
    <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> token<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token comment">// 进行sha1加密</span>
    <span class="token keyword">const</span> sha1Str <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
    <span class="token comment">// 加密字符串进行微信服务器比较。比较成功返回随机字符串，比较失败返回error。</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>sha1Str <span class="token operator">===</span> signature<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>echostr<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* app.js:路由接口启动文件 */</span>
<span class="token comment">// 引入express并创建app应用对象</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 引入auth中间件函数</span>
<span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./wechat/auth'</span><span class="token punctuation">)</span>
<span class="token comment">// 添加默认根路径请求路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 开启监听端口号</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器启动成功'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="微信公众号功能开发"><a href="#微信公众号功能开发" class="header-anchor">#</a> 微信公众号功能开发</h2> <h3 id="使用request库发送请求"><a href="#使用request库发送请求" class="header-anchor">#</a> 使用request库发送请求</h3> <p><strong>安装：</strong><code>cnpm i request request-promise-native --save</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> rp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request-promise-native'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'www.xxx.com'</span>
<span class="token comment">// 返回值是promise对象</span>
<span class="token function">rp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>method<span class="token operator">:</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> json<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>####### ###</p> <h3 id="获取唯一接口调用凭据"><a href="#获取唯一接口调用凭据" class="header-anchor">#</a> 获取唯一接口调用凭据</h3> <p>access_token是公众号的全局唯一接口调用凭据，公众号调用各接口时都需使用access_token。开发者需要进行妥善保存。access_token的存储至少要保留512个字符空间。access_token的有效期目前为2个小时，需定时刷新，重复获取将导致上次获取的access_token失效。</p> <p>**请求地址(get)😗*https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET
<strong>请求参数:</strong> <code>grant_type:'client_credential'</code> <code>appid: 第三方用户唯一凭证</code> <code>secret: 第三方用户唯一凭证密钥</code></p> <p><img src="/mao-blog/assets/img/wypz.4794df27.jpg" alt="1586405253(1)"></p> <p>####### ###</p> <h3 id="微信服务器post请求类型"><a href="#微信服务器post请求类型" class="header-anchor">#</a> 微信服务器POST请求类型</h3> <p>微信服务器POST请求开发者服务器类型</p> <p><img src="/mao-blog/assets/img/POSTrequest.4bd7cc45.jpg" alt="1586493507(1)"></p> <p>####### ###</p> <h3 id="响应微信服务器post类型"><a href="#响应微信服务器post类型" class="header-anchor">#</a> 响应微信服务器POST类型</h3> <p>开发者服务器响应微信服务器POST类型</p> <p><img src="/mao-blog/assets/img/POSTres.42de972f.jpg" alt="1586494626(1)"></p> <p>####### ###</p> <h3 id="获取消息并自动回复"><a href="#获取消息并自动回复" class="header-anchor">#</a> 获取消息并自动回复</h3> <p>微信服务器会发送两种类型消息给开发者服务器
**GET请求：**验证服务器有效性
**POST请求：**微信服务器会将用户发送的数据以POST请求转发到开发者服务器上
如果开发者服务器没有返回响应，微信服务器会发送多三次响应
接收请求体中的数据，是流体数据，不能直接拿到数据
数据接收完毕后，是Buffer对象。转换后是xml数据</p> <p><img src="/mao-blog/assets/img/zdhf.6097298a.jpg" alt="1586425881(1)"></p> <p>####### ###</p> <h3 id="创建自定义菜单"><a href="#创建自定义菜单" class="header-anchor">#</a> 创建自定义菜单</h3> <p>注意：调用删除菜单接口需要向params传入access_token，调用创建菜单需要向请求体(data)传入json数据</p> <p><img src="/mao-blog/assets/img/menu.d6c737ca.jpg" alt="1586504854(1)"></p> <p>####### ###</p> <h2 id="后台渲染ejs页面"><a href="#后台渲染ejs页面" class="header-anchor">#</a> 后台渲染ejs页面</h2> <p><strong>安装ejs：</strong><code>cnpm i ejs --save</code></p> <h3 id="配置ejs页面路由"><a href="#配置ejs页面路由" class="header-anchor">#</a> 配置ejs页面路由</h3> <p><code>wpp_server/app.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./wechat/auth'</span><span class="token punctuation">)</span>

<span class="token comment">// 配置模板资源目录的绝对路径</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/views</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token comment">// 配置模板引擎</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'ejs'</span><span class="token punctuation">)</span>
<span class="token comment">// 渲染路由页面, 将渲染好的页面返回给用户</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'search'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 开启监听端口号</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start_server:http://localhost:3000/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="微信公众号js-sdk"><a href="#微信公众号js-sdk" class="header-anchor">#</a> 微信公众号JS-SDK</h2> <p>微信JS-SDK ( JavaScript Software Development Kit )是微信公众平台面向网页开发者提供的基于微信内的网页开发工具包。</p> <p>通过使用微信JS-SDK，网页开发者可借助微信高效地使用拍照、选图、语音、位置等手机系统的能力，同时可以直接使用微信分享、扫一扫、卡券、支付等微信特有的能力，为微信用户提供更优质的网页体验。</p> <p>简单来说，使用JS-SDK我们可以引入外部网页并使用微信公众号提供的API。</p> <h3 id="获取-ticket-临时票据"><a href="#获取-ticket-临时票据" class="header-anchor">#</a> 获取 ticket 临时票据</h3> <p>jsapi_ticket是公众号用于调用微信JS接口的临时票据。正常情况下，jsapi_ticket的有效期为7200秒，通过access_token来获取。</p> <p><img src="/mao-blog/assets/img/hqjsapi_ticket.d6d6b98a.jpg" alt="hqjsapi_ticket"></p> <h3 id="计算-js-sdk-签名到渲染页面"><a href="#计算-js-sdk-签名到渲染页面" class="header-anchor">#</a> 计算 JS_SDK 签名到渲染页面</h3> <p><code>wpp_server/app.js</code></p> <div class="language- extra-class"><pre class="language-text"><code>1.组合参与签名的四个参数:jsapi_ticket(临时票据)、noncestr(随机字符串)、timestamp(时间戳)、url(当前服务器地址)
2.将其进行字典序排序, 以'&amp;'拼接在一起
3.进行sha1加密, 最终生成js-skd签名
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> auth <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./reply/auth'</span><span class="token punctuation">)</span>

<span class="token comment">// 引入wechat_api构造功能函数</span>
<span class="token keyword">const</span> wechat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">require</span><span class="token punctuation">(</span><span class="token string">'./wechat/wechat'</span><span class="token punctuation">)</span>

<span class="token comment">// 配置模板资源目录的绝对路径</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/views</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token comment">// 配置模板引擎</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'ejs'</span><span class="token punctuation">)</span>
<span class="token comment">// 渲染路由页面, 将渲染好的页面返回给用户</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>ticket<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> wechat<span class="token punctuation">.</span><span class="token function">fetchJsapiTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> noncestr <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100000000000000000</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> timestamp <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>url<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> js_sdk_sign <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">jsapi_ticket=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ticket<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">noncestr=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>noncestr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">timestamp=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>timestamp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/search</span><span class="token template-punctuation string">`</span></span> <span class="token comment">// 哪个路由页面需要就把哪个路由的查询字符串拼接</span>
    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>
    <span class="token comment">// 渲染页面, 传入签名, 随机字符串, 当前时间戳</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'search'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signature<span class="token punctuation">,</span> noncestr<span class="token punctuation">,</span> timestamp <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 添加默认根路径请求路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 开启监听端口号</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start_server:http://localhost:3000/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="js-sdk-接口授权步骤"><a href="#js-sdk-接口授权步骤" class="header-anchor">#</a> JS_SDK 接口授权步骤</h3> <p><strong>步骤一：绑定域名</strong></p> <p><img src="/mao-blog/assets/img/yuming.656eb32a.png" alt="图片5"></p> <p><strong>步骤二：引入JS文件</strong></p> <p><code>view/search.ejs</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>search<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>这是一个搜索页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://res.wx.qq.com/open/js/jweixin-1.6.0.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>步骤三：通过config注入权限验证</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>search<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>这是一个搜索页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://res.wx.qq.com/open/js/jweixin-1.6.0.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
          wx<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，</span>
          <span class="token comment">// 若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span>
            debug<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
            appId<span class="token operator">:</span> <span class="token string">'wxa2a6b98bb1a339d6'</span><span class="token punctuation">,</span> <span class="token comment">// 必填，公众号的唯一标识</span>
            timestamp<span class="token operator">:</span> <span class="token string">'&lt;%= timestamp %&gt;'</span><span class="token punctuation">,</span> <span class="token comment">// 必填，生成签名的时间戳</span>
            nonceStr<span class="token operator">:</span> <span class="token string">'&lt;%= noncestr %&gt;'</span><span class="token punctuation">,</span> <span class="token comment">// 必填，生成签名的随机串</span>
            signature<span class="token operator">:</span> <span class="token string">'&lt;%= signature %&gt;'</span><span class="token punctuation">,</span><span class="token comment">// 必填，签名</span>
            jsApiList<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 必填，需要使用的JS接口列表</span>
                <span class="token string">'onMenuShareQQ'</span><span class="token punctuation">,</span>    <span class="token comment">// “分享到QQ”按钮点击状态及自定义分享内容接口</span>
                <span class="token string">'onMenuShareQZone'</span><span class="token punctuation">,</span> <span class="token comment">//  “分享到QQ空间”按钮点击状态及自定义分享内容接口</span>
                <span class="token string">'startRecord'</span><span class="token punctuation">,</span>      <span class="token comment">// 开始录音</span>
                <span class="token string">'stopRecord'</span><span class="token punctuation">,</span>       <span class="token comment">// 结束录音</span>
                <span class="token string">'translateVoice'</span>    <span class="token comment">// 识别音频返回文字结果</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wx<span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，</span>
			<span class="token comment">// config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，</span>
			<span class="token comment">// 则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，</span>
			<span class="token comment">// 则可以直接调用，不需要放在ready函数中。</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// config信息验证失败会执行error方法</span>
        wx<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>步骤四：在微信开发者工具查看授权状况</strong></p> <p><img src="/mao-blog/assets/img/js-sdksq.dcb3744d.jpg" alt="js-sdk授权成功"></p> <p><strong>wx.ready中判断接口可用性</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>wx<span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">checkJsApi</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        jsApiList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token comment">// 需要检测的JS接口列表，所有JS接口列表见附录2,</span>
            <span class="token string">'onMenuShareQQ'</span><span class="token punctuation">,</span> <span class="token string">'onMenuShareQZone'</span><span class="token punctuation">,</span> <span class="token string">'startRecord'</span><span class="token punctuation">,</span>
            <span class="token string">'stopRecord'</span><span class="token punctuation">,</span> <span class="token string">'translateVoice'</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 以键值对的形式返回，可用的api值true，不可用为false</span>
            <span class="token comment">// 如：{&quot;checkResult&quot;:{&quot;onMenuShareQQ&quot;:true},&quot;errMsg&quot;:&quot;checkJsApi:ok&quot;}</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="调用录音并识别结果"><a href="#调用录音并识别结果" class="header-anchor">#</a> 调用录音并识别结果</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 是否在录音</span>
<span class="token keyword">let</span> isRecord <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.record'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRecord<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 开始录音</span>
        wx<span class="token punctuation">.</span><span class="token function">startRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 结束录音</span>
        wx<span class="token punctuation">.</span><span class="token function">stopRecord</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// 结束录音后, 自动上传微信服务器中, 返回一个音频ID</span>
                <span class="token keyword">const</span> <span class="token punctuation">{</span> localId <span class="token punctuation">}</span> <span class="token operator">=</span> res
                wx<span class="token punctuation">.</span><span class="token function">translateVoice</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    localId<span class="token punctuation">,</span>   <span class="token comment">// 需要识别的音频ID</span>
                    isShowProgressTips<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 默认为1, 显示进度提示</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 语音识别结果</span>
                        <span class="token keyword">const</span> <span class="token punctuation">{</span> translateResult <span class="token punctuation">}</span> <span class="token operator">=</span> res
                        <span class="token function">alert</span><span class="token punctuation">(</span>translateResult<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="js-sdk-接口调用说明"><a href="#js-sdk-接口调用说明" class="header-anchor">#</a> JS_SDK 接口调用说明</h3> <p>所有接口通过wx对象(也可使用jWeixin对象)来调用，参数是一个对象，除了每个接口本身需要传的参数之外，还有以下通用参数：</p> <div class="language- extra-class"><pre class="language-text"><code>success：接口调用成功时执行的回调函数。
fail：接口调用失败时执行的回调函数。
complete：接口调用完成时执行的回调函数，无论成功或失败都会执行。
cancel：用户点击取消时的回调函数，仅部分有用户取消操作的api才会用到。
trigger: 监听Menu中的按钮点击时触发的方法，该方法仅支持Menu中的相关接口。
</code></pre></div><p>以上几个函数都带有一个参数，类型为对象，其中除了每个接口本身返回的数据之外，还有一个通用属性errMsg，其值格式如下：</p> <div class="language- extra-class"><pre class="language-text"><code>调用成功时：&quot;xxx:ok&quot; ，其中xxx为调用的接口名
用户取消时：&quot;xxx:cancel&quot;，其中xxx为调用的接口名
调用失败时：其值为具体错误信息
</code></pre></div><h2 id="使用路由中间件"><a href="#使用路由中间件" class="header-anchor">#</a> 使用路由中间件</h2> <p>使用路由中间件改善项目结构</p> <p><code>router/index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建router实例</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 添加路由</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token comment">// 暴露router</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre></div><p><code>app.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入express并创建app应用对象</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 配置模板资源目录的绝对路径</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/views</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token comment">// 配置模板引擎</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'ejs'</span><span class="token punctuation">)</span>
<span class="token comment">// 开启监听端口号</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start_server:http://localhost:3000/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>####### ###</p> <h2 id="puppeteer-爬取页面数据"><a href="#puppeteer-爬取页面数据" class="header-anchor">#</a> puppeteer 爬取页面数据</h2> <p>Puppeteer 是 Chrome 开发团队在 2017 年发布的一个 Node.js 包，用来模拟 Chrome 浏览器的运行。</p> <h3 id="puppeter-可实现功能"><a href="#puppeter-可实现功能" class="header-anchor">#</a> puppeter 可实现功能</h3> <ul><li>网页截图或者生成 PDF</li> <li>爬取 SPA 或 SSR 网站</li> <li>UI 自动化测试，模拟表单提交，键盘输入，点击等行为</li> <li>捕获网站的时间线，帮助诊断性能问题</li> <li>创建一个最新的自动化测试环境，使用最新的 js 和最新的 Chrome 浏览器运行测试用例</li> <li>测试 Chrome 扩展程序</li></ul> <h3 id="headless-chrome-概念"><a href="#headless-chrome-概念" class="header-anchor">#</a> Headless Chrome 概念</h3> <ul><li>在无界面的环境中运行 Chrome</li> <li>通过命令行或者程序语言操作 Chrome</li> <li>无需人的干预，运行更稳定</li> <li>在启动 Chrome 时添加参数 --headless，便可以 headless 模式启动 Chrome</li></ul> <h3 id="puppeteer-api-分层结构"><a href="#puppeteer-api-分层结构" class="header-anchor">#</a> Puppeteer API 分层结构</h3> <p>Puppeteer 中的 API 分层结构基本和浏览器保持一致，下面对常使用到的几个类：</p> <img src="https://pic1.zhimg.com/80/v2-f0f7c2390015845d1addabe4f816a8fc_720w.jpg" style="zoom:80%;"> <div class="language- extra-class"><pre class="language-text"><code>Browser： 对应一个浏览器实例，一个 Browser 可以包含多个 BrowserContext

BrowserContext： 对应浏览器一个上下文会话，就像我们打开一个普通的 Chrome 之后又打开一个隐身模式的浏览器一样，BrowserContext 具有独立的 Session(cookie 和 cache 独立不共享)，一个 BrowserContext 可以包含多个 Page

Page：表示一个 Tab 页面，通过 browserContext.newPage()/browser.newPage() 创建，browser.newPage() 创建页面时会使用默认的 BrowserContext，一个 Page 可以包含多个 Frame

Frame: 一个框架，每个页面有一个主框架（page.MainFrame()）,也可以多个子框架，主要由 iframe 标签创建产生的

ExecutionContext： 是 javascript 的执行环境，每一个 Frame 都一个默认的 javascript 执行环境

ElementHandle: 对应 DOM 的一个元素节点，通过该该实例可以实现对元素的点击，填写表单等行为，我们可以通过选择器，xPath 等来获取对应的元素

JsHandle：对应 DOM 中的 javascript 对象，ElementHandle 继承于 JsHandle，由于我们无法直接操作 DOM 中对象，所以封装成 JsHandle 来实现相关功能

CDPSession：可以直接与原生的 CDP 进行通信，通过 session.send 函数直接发消息，通过 session.on 接收消息，可以实现 Puppeteer API 中没有涉及的功能

Coverage：获取 JavaScript 和 CSS 代码覆盖率

Tracing：抓取性能数据进行分析

Response： 页面收到的响应

Request： 页面发出的请求
</code></pre></div><h3 id="puppeteer-的基本使用"><a href="#puppeteer-的基本使用" class="header-anchor">#</a> puppeteer 的基本使用</h3> <p><strong>安装：</strong><code>cnpm i --save puppeteer-core</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 打开浏览器</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>headless<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 新建标签页</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 标签页跳转网址</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 自定义操作(截屏)</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token operator">:</span> <span class="token string">'example.png'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 关闭浏览器</span>
  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="puppeteer-操作dom爬取数据返回"><a href="#puppeteer-操作dom爬取数据返回" class="header-anchor">#</a> puppeteer 操作dom爬取数据返回</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>headless<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 操作页面dom对象方法并接受返回值(爬取数据)</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 这里的环境是浏览器页面环境, 如果页面有jquery对象, 那么这里也可以用jquery方法</span>
    <span class="token comment">// 该函数不能访问外面的数据, 因为这里的环境是浏览器环境</span>
    <span class="token comment">// 该函数执行完毕后, 会自动关闭浏览器页面</span>
    
    <span class="token comment">// 爬取数据</span>
    <span class="token keyword">const</span> genre <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;[property='v:genre']&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>innerText<span class="token punctuation">)</span>
		<span class="token comment">// 将数据返回</span>
    <span class="token keyword">return</span> genre
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 爬取完毕后result则等于genre</span>

  <span class="token comment">// 下面还可以根据爬取的数据在进行页面跳转并爬取数据, 如果是数组还可以用for来达到同步执行的效果</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">/*......*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="七牛服务器数据管理"><a href="#七牛服务器数据管理" class="header-anchor">#</a> 七牛服务器数据管理</h2> <p>七牛对象存储将数据文件以资源的形式上传到空间中。可以创建一个或者多个空间，然后向每个空间中上传一个或多个文件。通过获取已上传文件的地址进行文件的分享和下载。还可以通过修改存储空间或文件的属性或元信息来设置相应的访问权限。<a href="https://developer.qiniu.com/kodo" target="_blank" rel="noopener noreferrer">对象储存产品手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="空间图形界面使用步骤"><a href="#空间图形界面使用步骤" class="header-anchor">#</a> 空间图形界面使用步骤</h3> <h4 id="步骤一-创建空间"><a href="#步骤一-创建空间" class="header-anchor">#</a> 步骤一：创建空间</h4> <p><strong>1. 登录 <a href="https://portal.qiniu.com/signin" target="_blank" rel="noopener noreferrer">七牛开发者平台<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。进入存储空间 <a href="https://portal.qiniu.com/bucket" target="_blank" rel="noopener noreferrer">管理界面<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <p><img src="https://dn-odum9helk.qbox.me/Fvtqd7vo1AQyv2H9p9nqZRa8MqDs" alt=""></p> <p><strong>2. <a href="https://portal.qiniu.com/bucket/create" target="_blank" rel="noopener noreferrer">新建存储空间<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <p><img src="https://dn-odum9helk.qbox.me/FihUPil_2gswxkXryUHN6jWutB8g" alt=""></p> <p><a href="%E5%9B%A0%E4%B8%BA%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E9%AA%8C%E8%AF%81%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%BF%9B%E8%A1%8C%EF%BC%88%E5%9C%A8%E4%B8%9A%E5%8A%A1%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%9B%E5%BB%BA%EF%BC%8C%E5%9C%A8%E4%BA%91%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%AA%8C%E8%AF%81%EF%BC%89%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E4%B8%9A%E5%8A%A1%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9C%80%E8%A6%81%E5%B0%BD%E5%8F%AF%E8%83%BD%E6%A0%A1%E5%87%86%E6%97%B6%E9%97%B4%EF%BC%8C%E5%90%A6%E5%88%99%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E5%87%AD%E8%AF%81%E5%88%9A%E5%88%9B%E5%BB%BA%E5%B0%B1%E8%BF%87%E6%9C%9F%E7%AD%89%E5%90%84%E7%A7%8D%E5%A5%87%E6%80%AA%E7%9A%84%E9%97%AE%E9%A2%98%E3%80%82">^注意</a>: 如果您是体验用户，新建存储空间时，会遇到 “新建存储空间失败，请先实名认证”</p> <p><strong>3. 创建成功后在 内容管理 栏目中可以上传、下载、访问、修改资源等操作。</strong></p> <p><img src="https://dn-odum9helk.qbox.me/FvHsoIbaXlQUHhniZ3tuIfSp9pW7" alt=""></p> <h4 id="步骤二-上传文件"><a href="#步骤二-上传文件" class="header-anchor">#</a> 步骤二：上传文件</h4> <p>已经创建了空间，就可以向空间里上传资源。资源可以是任意的文件：文档，照片，视频，音乐文件，或其它文件类型。</p> <p><strong>内容管理 --&gt; 上传文件</strong></p> <p><img src="https://dn-odum9helk.qbox.me/FnFEcvAyUeGGjv1AvM0iNXc6qk-a" alt=""></p> <h4 id="步骤三-下载文件"><a href="#步骤三-下载文件" class="header-anchor">#</a> 步骤三：下载文件</h4> <p>添加了文件到空间，就可以通过图形界面打开和查看它。您也可以下载该文件到您的本地计算机。</p> <p><strong>内容管理 --&gt; 右侧资源点击'...', 点击下载文件</strong></p> <p><img src="https://dn-odum9helk.qbox.me/FoTIhsjMdq0Br2OtVIVuwULhehHv" alt=""></p> <h4 id="步骤四-删除文件"><a href="#步骤四-删除文件" class="header-anchor">#</a> 步骤四：删除文件</h4> <p>如果不再需要把上传的文件保存在七牛空间中，您可以删除它。</p> <p><strong>内容管理 --&gt; 右侧资源点击'...', 点击删除文件</strong></p> <p><img src="https://dn-odum9helk.qbox.me/FoTIhsjMdq0Br2OtVIVuwULhehHv" alt=""></p> <h4 id="步骤五-删除空间"><a href="#步骤五-删除空间" class="header-anchor">#</a> 步骤五：删除空间</h4> <p>如果不需要之前创建的空间，可以删除它。</p> <p><img src="https://dn-odum9helk.qbox.me/Fs54zF7X1aPla7MJr651na9KItpM" alt=""></p> <h3 id="编程模型"><a href="#编程模型" class="header-anchor">#</a> 编程模型</h3> <p>以保护数据安全和考虑架构合理性为出发点，七牛云存储服务对如何进行开发提供了一些设计和编码建议。希望开发者在使用七牛云存储服务之前详细阅读这些建议，并尽可能的符合这些原则，以免造成不必要的时间浪费和带来数据安全风险。</p> <h4 id="基本结构"><a href="#基本结构" class="header-anchor">#</a> 基本结构</h4> <p>基于七牛云存储服务构建的应用，建议使用如下基本架构：</p> <p><img src="https://dn-odum9helk.qbox.me/FuAHhZgiYaHTDqLritFe1K85AVrI" alt=""></p> <h4 id="业务流程"><a href="#业务流程" class="header-anchor">#</a> 业务流程</h4> <p>**上传：**客户端在上传资源到七牛云存储之前要先从业务服务器获取一个有效的<a href="https://developer.qiniu.com/kodo/manual/1208/upload-token" target="_blank" rel="noopener noreferrer">上传凭证<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，因此需要先后和两个服务端打交道。</p> <p><img src="https://dn-odum9helk.qbox.me/Fmy1Y_s9I4oCPYuMGDrvYxCRv2FM" alt=""></p> <p>如果有设置回调，则上传完成时七牛云存储会自动发起回调到指定的业务服务器。</p> <p><img src="https://dn-odum9helk.qbox.me/FkPZ31ECmtGnEisOahMKc5kQkuRr" alt=""></p> <p>**下载：**公开资源不需要对应的下载凭证，客户端可以直接从七牛云存储下载对应资源。私有资源需要对应的下载凭证，因此必须先和业务服务器打交道。</p> <p>按照实际的使用场景，客户端对于内容的展示非常类似一个动态网页的生成过程，因此无论该页面内容是公开还是私有，均需要从业务服务器获取展示该页面的动态布局信息。所以通常显示过程也是需要先后和业务服务器及七牛云存储服务打交道。</p> <h4 id="关键原则"><a href="#关键原则" class="header-anchor">#</a> 关键原则</h4> <ul><li>整个架构中需要一个业务服务器组件。</li> <li>无论如何，<a href="https://developer.qiniu.com/af/kb/1334" target="_blank" rel="noopener noreferrer">访问密钥（AK/SK）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>均不得包含在客户端的分发包中（如二进制代码、配置文件或网页中）。</li> <li>SecretKey不得在任何场景中的公网上传输，更不得传输到客户端。</li> <li>业务服务器端应维持一个用于管理资源元数据的数据库和一个用于管理最终用户账号信息的数据库。</li> <li>原则上客户端和七牛云存储之间的交互只有上传和下载，不应使用任何其他的API。</li></ul> <h3 id="安全机制"><a href="#安全机制" class="header-anchor">#</a> 安全机制</h3> <p>数据安全性是云存储服务的重中之重。云存储的安全机制主要需要考虑以下几个因素：</p> <ul><li>如何判断该请求方是否合法，且对目标空间有相应的访问权限。</li> <li>因为服务的访问协议同时支持 HTTP 和 HTTPS，服务端需要判断收到的请求是否经过篡改。</li> <li>相比上传新资源，覆盖文件或删除已有资源拥有更高的风险。因此对上传或修改动作，需要确认请求方是否拥有修改或删除的权限。</li></ul> <p>需要考虑安全机制的场景主要有如下几种：<strong>上传资源、访问资源、管理和修改资源</strong></p> <p>因为凭证的生成需要用到<a href="https://developer.qiniu.com/kodo/manual/1644/security#aksk" target="_blank" rel="noopener noreferrer">SecretKey<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，因此该生成动作不应在不受信任的环境中进行。需要注意的是，开发者绝不能将密钥包含在分发给最终用户的程序中，无论是包含在配置文件中还是二进制文件中都会带来非常大的密钥泄漏风险。</p> <p>七牛云存储推荐的模型如下所示：</p> <p><img src="https://dn-odum9helk.qbox.me/Fi5KMuul0usiNB7_OyofIjVw-K2e" alt=""></p> <h4 id="密钥-accesskey-secretkey"><a href="#密钥-accesskey-secretkey" class="header-anchor">#</a> 密钥（AccessKey/SecretKey）</h4> <p>密钥用于以上几种凭证的生成。以 SecretKey 为参数，配合适当的签名算法，可以得到原始信息的数字签名，防止内容在传递过程中被伪造或篡改。</p> <p>密钥通常是成对创建和使用，包含一个 AccessKey 和一个 SecretKey。其中 AccessKey 会在传输中包含，而用户必须保管好 SecretKey 不在网络上传输以防止被窃取。若 SecretKey 被恶意第三方窃取，可能导致非常严重的数据泄漏风险。因此，如发现 SecretKey 被非法使用，管理员应第一时间在七牛开发者平台的<a href="https://portal.qiniu.com/user/key" target="_blank" rel="noopener noreferrer">密钥管理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中更换密钥。</p> <h4 id="上传凭证-uploadtoken"><a href="#上传凭证-uploadtoken" class="header-anchor">#</a> 上传凭证（UploadToken）</h4> <p>客户端上传前需要先获取从服务端颁发的上传凭证，并在上传资源时将上传凭证包含为请求内容的一部分。不带凭证或带非法凭证的请求将返回 HTTP 错误码 401，代表认证失败。关于上传策略和上传凭证的生成细节，请查阅<a href="https://developer.qiniu.com/kodo/manual/1208/upload-token" target="_blank" rel="noopener noreferrer">上传凭证<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><strong>生成上传凭证时需要指定以下要素：</strong></p> <ul><li><p>权限，指定上传的目标空间或允许覆盖的指定资源。</p></li> <li><p>凭证有效期，即一个符合<a href="https://developer.qiniu.com/kodo/glossary/1647/u" target="_blank" rel="noopener noreferrer">Unix时间戳<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>规范的数值，单位为秒。</p></li> <li><p>可选择设置的最终用户标识 ID。这是为了让业务服务器在收到结果回调时能够识别产生该请求的最终用户信息。</p></li></ul> <h4 id="下载凭证-downloadtoken"><a href="#下载凭证-downloadtoken" class="header-anchor">#</a> 下载凭证（DownloadToken）</h4> <p>下载私有资源的请求需要带一个合法的下载凭证。不带凭证或带非法凭证的请求将返回 HTTP 错误码 401，代表认证失败。关于下载凭证的生成细节，请查阅<a href="https://developer.qiniu.com/kodo/manual/1202/download-token" target="_blank" rel="noopener noreferrer">下载凭证<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>与上传凭证相比，下载凭证的作用比较简单：</p> <ul><li>保证请求发起者拥有对目标空间的访问权限。</li> <li>保证服务端收到的下载请求内容未经中途篡改，具体包括目标资源的 URI 和该访问请求的有效期信息均应未受到篡改。</li></ul> <h4 id="管理凭证-accesstoken"><a href="#管理凭证-accesstoken" class="header-anchor">#</a> 管理凭证（AccessToken）</h4> <p>在管理现有资源时，例如查看资源元数据、删除或移动资源等，通常需要带一个合法的管理凭证。不带凭证或带非法凭证的管理请求将返回 HTTP 错误码 401，代表认证失败。关于管理凭证的生成细节，请查阅<a href="https://developer.qiniu.com/kodo/manual/1201/access-token" target="_blank" rel="noopener noreferrer">管理凭证<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>管理凭证的作用与下载凭证比较类似：</p> <ul><li>保证请求发起者拥有对目标空间的管理权限。</li> <li>保证服务端收到的管理请求内容未经中途篡改，具体包括代表管理动作的 URI 和该管理动作的参数信息均应未受到篡改。</li></ul> <h4 id="防盗链"><a href="#防盗链" class="header-anchor">#</a> 防盗链</h4> <p>下载还有一种常见的场景，即公开资源的防盗链，例如禁止特定来源域名的访问，禁止非浏览器发起的访问等。
可以通过 HTTP 协议支持的 Referer 机制即<a href="https://developer.qiniu.com/kodo/glossary/1643/h" target="_blank" rel="noopener noreferrer">HTTP Referer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来进行相应的来源识别和管理。
防盗链是一个系统设置，不影响开发工作。如发现有盗链情况，在<a href="https://portal.qiniu.com/" target="_blank" rel="noopener noreferrer">七牛开发者平台<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>里的 <strong>融合CDN加速</strong> 中的 <strong>高级配置</strong>进行设置。</p> <h4 id="跨域访问"><a href="#跨域访问" class="header-anchor">#</a> 跨域访问</h4> <p>出于安全的考虑，Web 浏览器从很早之前就定下同域安全策略的标准，默认情况下同一域名下的页面只能向同域（包括 CNAME 域名、端口）下的 URL 发送所有类型的 HTTP 请求。而向不同域的地址发送非 GET 请求时，默认情况下只能返回同域安全策略错误。</p> <p>对此，在发起上传或下载请求的时候，服务会返回相应的支持跨域的 Header：</p> <p>上传(<code>upload.qiniup.com</code>)</p> <div class="language- extra-class"><pre class="language-text"><code>Access-Control-Allow-Headers: X-File-Name, X-File-Type, X-File-Size
Access-Control-Allow-Methods: OPTIONS, HEAD, POST
Access-Control-Allow-Origin: *
</code></pre></div><p>下载(<code>.qiniudn.com</code>)</p> <div class="language- extra-class"><pre class="language-text"><code>Access-Control-Allow-Origin: *
</code></pre></div><h2 id="七牛服务器-qiniu-sdk"><a href="#七牛服务器-qiniu-sdk" class="header-anchor">#</a> 七牛服务器 QINIU-SDK</h2> <p>此 SDK 适用于 Node.js v4 及以上版本。使用此 SDK 构建网络应用程序，能以非常便捷的方式将数据安全地存储到七牛云上。无论网络应用是一个网站程序，还是包括从云端（服务端程序）到终端（手持设备应用）的架构服务和应用，通过七牛云及其 SDK，都能让应用程序的终端用户高速上传和下载，同时也让服务端更加轻盈。<a href="https://developer.qiniu.com/kodo/sdk/1289/nodejs" target="_blank" rel="noopener noreferrer">官方Node.js SDK文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>安装：</strong><code>cnpm install qiniu --save-dev</code></p> <p>**获取AccessKey / SecretKey：**官网=&gt;管理控制台=&gt;个人信息=&gt;密匙管理</p> <p>**获取对应储存区域简称：**https://developer.qiniu.com/kodo/manual/1671/region-endpoint</p> <h3 id="创建资源管理对象"><a href="#创建资源管理对象" class="header-anchor">#</a> 创建资源管理对象</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 抓取网络资源到空间</span>
<span class="token keyword">const</span> qiniu <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'qiniu'</span><span class="token punctuation">)</span>
<span class="token comment">// 用户密匙</span>
<span class="token keyword">const</span> <span class="token constant">ACCESS_KEY</span> <span class="token operator">=</span> <span class="token string">'4RjWhCFFyxHHPXYBn8u0oGkJWtVGLaJWQxzDQpEd'</span>
<span class="token keyword">const</span> <span class="token constant">SECRET_KEY</span> <span class="token operator">=</span> <span class="token string">'qEQXMw3iUIYT0xxuLZWsVGMdA5Tvt5rC7HnFasR9'</span>
<span class="token comment">// 定义鉴权对象</span>
<span class="token keyword">const</span> mac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>digest<span class="token punctuation">.</span>Mac</span><span class="token punctuation">(</span><span class="token constant">ACCESS_KEY</span><span class="token punctuation">,</span> <span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 定义配置对象</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配置储存区域为z0(华东)</span>
config<span class="token punctuation">.</span>zone <span class="token operator">=</span> qiniu<span class="token punctuation">.</span>zone<span class="token punctuation">.</span>Zone_z0<span class="token punctuation">;</span>
<span class="token comment">// 创建资源管理对象，该功能模块可以进行管理资源的大部分操作</span>
<span class="token keyword">const</span> bucketManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">qiniu<span class="token punctuation">.</span>rs<span class="token punctuation">.</span>BucketManager</span><span class="token punctuation">(</span>mac<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="抓取网络资源到空间"><a href="#抓取网络资源到空间" class="header-anchor">#</a> 抓取网络资源到空间</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*  bucketManager.fetch(resUrl, bucket, key, callback(err, respBody, respInfo))
    resUrl: 网络资源地址
    bucket: 储存空间名称
    key: 重命名网络资源名称
    callback: 请求回调
    err: 错误码, 请求成功时为空
        respBody: 请求成功响应体对象,该对象有以下属性
            key(文件名称), hash(文件哈希值), fsize(文件大小), mimeType(文件类型)
        respInfo: 请求状态对象, 该对象有以下属性
            statusCode: 请求状态码, 当状态码为200代表上传成功
*/</span>
<span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token string">'yyy.png'</span>
<span class="token keyword">const</span> resUrl <span class="token operator">=</span> <span class="token string">'www.xxx.xxx/xxx.png'</span>
<span class="token keyword">const</span> bucket <span class="token operator">=</span> <span class="token string">'mr-mao-images'</span>
bucketManager<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>resUrl<span class="token punctuation">,</span> bucket<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> respBody<span class="token punctuation">,</span> respInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>respInfo<span class="token punctuation">.</span>statusCode <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 文件上传成功</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="使用dplayer构建h5播放器"><a href="#使用dplayer构建h5播放器" class="header-anchor">#</a> 使用DPlayer构建H5播放器</h2> <p><a href="http://dplayer.js.org/#/zh-Hans/" target="_blank" rel="noopener noreferrer">DPlayer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是一款可爱的HTML5 danmaku视频播放器，可帮助人们轻松构建视频和danmaku。</p> <h3 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h3> <h4 id="html中定义结构"><a href="#html中定义结构" class="header-anchor">#</a> html中定义结构</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DPlayer.min.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dplayer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DPlayer.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="javascript中定义行为"><a href="#javascript中定义行为" class="header-anchor">#</a> JavaScript中定义行为</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DPlayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 创建实例</span>
    container<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'dplayer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    screenshot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    video<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 视频配置</span>
        url<span class="token operator">:</span> <span class="token string">'demo.mp4'</span><span class="token punctuation">,</span>
        pic<span class="token operator">:</span> <span class="token string">'demo.jpg'</span><span class="token punctuation">,</span>
        thumbnails<span class="token operator">:</span> <span class="token string">'thumbnails.jpg'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    danmaku<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 弹幕服务器接口</span>
        id<span class="token operator">:</span> <span class="token string">'demo'</span><span class="token punctuation">,</span>
        api<span class="token operator">:</span> <span class="token string">'https://api.prprpr.me/dplayer/'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 切换视频</span>
dp<span class="token punctuation">.</span><span class="token function">switchVideo</span><span class="token punctuation">(</span>
   <span class="token comment">// 第一个参数是视频配置</span>
    <span class="token punctuation">{</span> url<span class="token punctuation">,</span> pic <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 第二个是弹幕api接口</span>
    <span class="token punctuation">{</span>id<span class="token punctuation">,</span> api<span class="token operator">:</span> <span class="token string">'http://localhost:3000/'</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
dp<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 播放视频</span>
dp<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 暂停视频</span>
dp<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 切换播放和暂停</span>
dp<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>time<span class="token operator">:</span> number<span class="token punctuation">)</span> <span class="token comment">// 跳转到特定时间</span>
dp<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>event<span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token function-variable function">handler</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">)</span> <span class="token comment">// 绑定视频和播放器事件，见#事件绑定</span>
dp<span class="token punctuation">.</span><span class="token function">switchVideo</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> danmaku<span class="token punctuation">)</span> <span class="token comment">// 切换到其他视频</span>
dp<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 销毁播放器</span>
dp<span class="token punctuation">.</span><span class="token function">speed</span><span class="token punctuation">(</span>rate<span class="token operator">:</span> number<span class="token punctuation">)</span> <span class="token comment">// 设置视频速度</span>
dp<span class="token punctuation">.</span><span class="token function">volume</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 设置视频音量</span>
</code></pre></div><h3 id="构建弹幕api接口"><a href="#构建弹幕api接口" class="header-anchor">#</a> 构建弹幕api接口</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DPlayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 创建实例</span>
    container<span class="token operator">:</span> <span class="token operator">...</span><span class="token punctuation">,</span>
    video<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    danmaku<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 弹幕服务器接口配置</span>
        <span class="token comment">// 弹幕池id</span>
        id<span class="token operator">:</span> <span class="token string">'demo'</span><span class="token punctuation">,</span> 
        <span class="token comment">// 弹幕接口</span>
        api<span class="token operator">:</span> <span class="token string">'https://api.prprpr.me/dplayer/'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="加载弹幕"><a href="#加载弹幕" class="header-anchor">#</a> 加载弹幕</h4> <p>创建DPlayer，以及切换视频时，会发送请求加载对应弹幕池弹幕
<strong>请求格式：</strong><code>GET</code> <strong>请求地址：</strong><code>danmaku.api</code> <strong>请求携带参数：</strong><code>danmaku.id</code> <strong>返回数据结构：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> data<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
        <span class="token number">3.3964</span><span class="token punctuation">,</span>   <span class="token comment">// 弹幕发送时间</span>
        <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token comment">// 弹幕的类型</span>
        <span class="token number">16777215</span><span class="token punctuation">,</span> <span class="token comment">// 弹幕的颜色</span>
        <span class="token string">&quot;DIYgod&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 弹幕的发送者</span>
        <span class="token string">&quot;11111&quot;</span>   <span class="token comment">// 弹幕的内容</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token operator">...</span>
<span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="发送弹幕"><a href="#发送弹幕" class="header-anchor">#</a> 发送弹幕</h4> <p>在视频中发送弹幕时，会发送请求给对应api接口
<strong>请求格式：</strong><code>POST</code> <strong>请求地址：</strong><code>danmaku.api</code> <strong>请求体携带参数：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>author<span class="token operator">:</span> <span class="token string">&quot;testuser&quot;</span> <span class="token comment">// 弹幕发送者</span>
color<span class="token operator">:</span> <span class="token number">16777215</span>    <span class="token comment">// 弹幕颜色</span>
id<span class="token operator">:</span> <span class="token string">&quot;demo&quot;</span>         <span class="token comment">// 弹幕池ID</span>
text<span class="token operator">:</span> <span class="token string">'123456'</span>     <span class="token comment">// 弹幕的内容</span>
time<span class="token operator">:</span> <span class="token number">0</span>            <span class="token comment">// 弹幕的发送时间</span>
type<span class="token operator">:</span> <span class="token number">0</span>            <span class="token comment">// 弹幕的类型</span>
</code></pre></div><p>需要响应的内容：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="其他库"><a href="#其他库" class="header-anchor">#</a> 其他库</h2> <h3 id="生成唯一key值"><a href="#生成唯一key值" class="header-anchor">#</a> 生成唯一key值</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入生成唯一key值库</span>
<span class="token keyword">const</span> nanoid <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'nanoid'</span><span class="token punctuation">)</span>
<span class="token function">nanoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 生成默认长度key值</span>
<span class="token function">nanoid</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// 生成指定长度key值</span>
</code></pre></div></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/33-uniapp-duo-duan-ying-yong-kai-fa.html" class="prev">
            uniapp 多端应用开发
          </a></span> <span class="next"><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/35-uniapp-duo-duan-ying-yong-kai-fa.html">
            uniapp 多端应用开发
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#微信公众号简述" class="sidebar-link reco-side-微信公众号简述" data-v-70334359>微信公众号简述</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#微信公众号的分类" class="sidebar-link reco-side-微信公众号的分类" data-v-70334359>微信公众号的分类</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#订阅与服务号的主要区别" class="sidebar-link reco-side-订阅与服务号的主要区别" data-v-70334359>订阅与服务号的主要区别</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#使用微信号" class="sidebar-link reco-side-使用微信号" data-v-70334359>使用微信号</a></li><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#映射服务器架构" class="sidebar-link reco-side-映射服务器架构" data-v-70334359>映射服务器架构</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#构建node-js服务器" class="sidebar-link reco-side-构建node-js服务器" data-v-70334359>构建node.js服务器</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#ngrok-映射内网端口" class="sidebar-link reco-side-ngrok-映射内网端口" data-v-70334359>ngrok 映射内网端口</a></li><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#微信公众号开发设置" class="sidebar-link reco-side-微信公众号开发设置" data-v-70334359>微信公众号开发设置</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#微信公众号的请求流程" class="sidebar-link reco-side-微信公众号的请求流程" data-v-70334359>微信公众号的请求流程</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#填写接口信息配置" class="sidebar-link reco-side-填写接口信息配置" data-v-70334359>填写接口信息配置</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#服务器接口信息配置" class="sidebar-link reco-side-服务器接口信息配置" data-v-70334359>服务器接口信息配置</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#验证服务器请求来源" class="sidebar-link reco-side-验证服务器请求来源" data-v-70334359>验证服务器请求来源</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#进行模块化管理" class="sidebar-link reco-side-进行模块化管理" data-v-70334359>进行模块化管理</a></li><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#微信公众号功能开发" class="sidebar-link reco-side-微信公众号功能开发" data-v-70334359>微信公众号功能开发</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#使用request库发送请求" class="sidebar-link reco-side-使用request库发送请求" data-v-70334359>使用request库发送请求</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#获取唯一接口调用凭据" class="sidebar-link reco-side-获取唯一接口调用凭据" data-v-70334359>获取唯一接口调用凭据</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#微信服务器post请求类型" class="sidebar-link reco-side-微信服务器post请求类型" data-v-70334359>微信服务器POST请求类型</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#响应微信服务器post类型" class="sidebar-link reco-side-响应微信服务器post类型" data-v-70334359>响应微信服务器POST类型</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#获取消息并自动回复" class="sidebar-link reco-side-获取消息并自动回复" data-v-70334359>获取消息并自动回复</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#创建自定义菜单" class="sidebar-link reco-side-创建自定义菜单" data-v-70334359>创建自定义菜单</a></li><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#后台渲染ejs页面" class="sidebar-link reco-side-后台渲染ejs页面" data-v-70334359>后台渲染ejs页面</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#配置ejs页面路由" class="sidebar-link reco-side-配置ejs页面路由" data-v-70334359>配置ejs页面路由</a></li><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#微信公众号js-sdk" class="sidebar-link reco-side-微信公众号js-sdk" data-v-70334359>微信公众号JS-SDK</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#获取-ticket-临时票据" class="sidebar-link reco-side-获取-ticket-临时票据" data-v-70334359>获取 ticket 临时票据</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#计算-js-sdk-签名到渲染页面" class="sidebar-link reco-side-计算-js-sdk-签名到渲染页面" data-v-70334359>计算 JS_SDK 签名到渲染页面</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#js-sdk-接口授权步骤" class="sidebar-link reco-side-js-sdk-接口授权步骤" data-v-70334359>JS_SDK 接口授权步骤</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#调用录音并识别结果" class="sidebar-link reco-side-调用录音并识别结果" data-v-70334359>调用录音并识别结果</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#js-sdk-接口调用说明" class="sidebar-link reco-side-js-sdk-接口调用说明" data-v-70334359>JS_SDK 接口调用说明</a></li><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#使用路由中间件" class="sidebar-link reco-side-使用路由中间件" data-v-70334359>使用路由中间件</a></li><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#puppeteer-爬取页面数据" class="sidebar-link reco-side-puppeteer-爬取页面数据" data-v-70334359>puppeteer 爬取页面数据</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#puppeter-可实现功能" class="sidebar-link reco-side-puppeter-可实现功能" data-v-70334359>puppeter 可实现功能</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#headless-chrome-概念" class="sidebar-link reco-side-headless-chrome-概念" data-v-70334359>Headless Chrome 概念</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#puppeteer-api-分层结构" class="sidebar-link reco-side-puppeteer-api-分层结构" data-v-70334359>Puppeteer API 分层结构</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#puppeteer-的基本使用" class="sidebar-link reco-side-puppeteer-的基本使用" data-v-70334359>puppeteer 的基本使用</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#puppeteer-操作dom爬取数据返回" class="sidebar-link reco-side-puppeteer-操作dom爬取数据返回" data-v-70334359>puppeteer 操作dom爬取数据返回</a></li><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#七牛服务器数据管理" class="sidebar-link reco-side-七牛服务器数据管理" data-v-70334359>七牛服务器数据管理</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#空间图形界面使用步骤" class="sidebar-link reco-side-空间图形界面使用步骤" data-v-70334359>空间图形界面使用步骤</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#编程模型" class="sidebar-link reco-side-编程模型" data-v-70334359>编程模型</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#安全机制" class="sidebar-link reco-side-安全机制" data-v-70334359>安全机制</a></li><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#七牛服务器-qiniu-sdk" class="sidebar-link reco-side-七牛服务器-qiniu-sdk" data-v-70334359>七牛服务器 QINIU-SDK</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#创建资源管理对象" class="sidebar-link reco-side-创建资源管理对象" data-v-70334359>创建资源管理对象</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#抓取网络资源到空间" class="sidebar-link reco-side-抓取网络资源到空间" data-v-70334359>抓取网络资源到空间</a></li><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#使用dplayer构建h5播放器" class="sidebar-link reco-side-使用dplayer构建h5播放器" data-v-70334359>使用DPlayer构建H5播放器</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#基本使用" class="sidebar-link reco-side-基本使用" data-v-70334359>基本使用</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#构建弹幕api接口" class="sidebar-link reco-side-构建弹幕api接口" data-v-70334359>构建弹幕api接口</a></li><li class="level-2" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#其他库" class="sidebar-link reco-side-其他库" data-v-70334359>其他库</a></li><li class="level-3" data-v-70334359><a href="/mao-blog/ruan-jian-kai-fa/qian-duan-bi-ji/34-wei-xin-gong-zhong-hao-fu-wu-kai-fa.html#生成唯一key值" class="sidebar-link reco-side-生成唯一key值" data-v-70334359>生成唯一key值</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><APlayer audio="" fixed="true" mini="true" autoplay="autoplay" theme="#b7daff" loop="loop" order="random" preload="auto" volume="0.15" mutex="true" lrc-type="0" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer><div></div><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:-55px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/mao-blog/assets/js/app.19e1b50c.js" defer></script><script src="/mao-blog/assets/js/4.512e8a4d.js" defer></script><script src="/mao-blog/assets/js/1.6b005ada.js" defer></script><script src="/mao-blog/assets/js/9.cea725c3.js" defer></script>
  </body>
</html>
